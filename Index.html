<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Rakshabandhan | Celebrating Sibling Bonds</title>
    <meta name="description" content="Send beautiful Rakshabandhan wishes to your loved ones">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #e83e8c;
            --secondary-color: #6f42c1;
            --accent-color: #ffc107;
            --text-color: #333;
            --light-bg: #f9f5ff;
            --white: #ffffff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--light-bg);
            background-image: radial-gradient(circle at 10% 20%, rgba(255, 200, 239, 0.1) 0%, rgba(255, 255, 255, 1) 90%);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            padding: 2.5rem;
            position: relative;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        
        h1 {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 2.8rem;
            margin-bottom: 1.5rem;
            text-align: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: 1.1rem;
            text-align: center;
            color: #666;
            margin-bottom: 1rem;
            font-weight: 300;
        }
        
        .name-input {
            margin: 1rem auto;
            text-align: center;
        }
        
        .name-input input {
            width: 80%;
            max-width: 400px;
            padding: 0.8rem 1rem;
            border: 2px solid #ddd;
            border-radius: 50px;
            font-size: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .name-input input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(232, 62, 140, 0.2);
        }
        
        .progress-share-section {
            margin: 2rem auto;
            max-width: 600px;
            text-align: center;
        }
        
        .share-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(232, 62, 140, 0.3);
            display: inline-flex;
            align-items: center;
            font-weight: 500;
            margin: 0.5rem auto;
        }
        
        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(232, 62, 140, 0.4);
        }
        
        .share-btn i {
            margin-right: 8px;
            font-size: 1.2rem;
        }
        
        .progress-container {
            margin-bottom: 1rem;
        }
        
        .progress-text {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #666;
        }
        
        .progress-bar {
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
            margin: 0 auto 1.5rem;
            width: 80%;
            max-width: 400px;
        }
        
        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 5px;
            transition: width 0.5s ease, box-shadow 0.5s ease;
        }
        
        .celebration {
            text-align: center;
            margin: 1rem 0;
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .image-container {
            margin: 2rem auto;
            max-width: 600px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .image-container:hover {
            transform: translateY(-5px);
        }
        
        .image-container img {
            width: 100%;
            display: block;
            height: auto;
            object-fit: cover;
        }
        
        .message {
            margin: 2rem auto;
            max-width: 600px;
            font-size: 1.1rem;
            text-align: center;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            position: relative;
        }
        
        .message::before {
            content: '"';
            position: absolute;
            font-size: 5rem;
            color: rgba(232, 62, 140, 0.1);
            top: -1.5rem;
            left: 0;
            line-height: 1;
            font-family: 'Playfair Display', serif;
        }
        
        /* Wheel Styles */
        .wheel-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 3rem auto;
            padding: 2rem 0;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            position: relative;
            max-width: 600px;
        }
        
        .wheel-title {
            font-family: 'Playfair Display', serif;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }
        
        .wheel-wrapper {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto 2rem;
        }
        
        .wheel {
            width: 100%;
            height: 100%;
            position: relative;
            border-radius: 50%;
            overflow: hidden;
            border: 8px solid #fff;
            box-shadow: 0 0 0 8px var(--primary-color), 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            transform: rotate(0deg);
        }
        
        .wheel-section {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: bottom right;
            left: 0;
            top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.2rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            clip-path: polygon(0% 0%, 100% 0%, 50% 100%);
        }
        
        .wheel-center {
            position: absolute;
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
            border: 5px solid var(--primary-color);
            box-shadow: 0 0 0 5px rgba(255,255,255,0.8);
        }
        
        .wheel-pointer {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%) rotate(180deg);
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            clip-path: polygon(50% 100%, 0 0, 100% 0);
            z-index: 10;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.3));
        }
        
        .spin-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(232, 62, 140, 0.3);
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        
        .spin-btn:disabled {
            background: #ddd;
            cursor: not-allowed;
            box-shadow: none;
            transform: none !important;
        }
        
        .spin-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(232, 62, 140, 0.4);
        }
        
        .spin-btn i {
            margin-right: 8px;
            font-size: 1.2rem;
        }
        
        .spin-count {
            margin-top: 0.5rem;
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .result {
            margin-top: 1.5rem;
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
            min-height: 2rem;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            background: rgba(232, 62, 140, 0.1);
            display: inline-block;
        }
        
        /* Custom Alert Dialog Styles */
        .custom-alert {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .alert-content {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .alert-title {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-weight: bold;
        }
        
        .alert-message {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: var(--text-color);
        }
        
        .withdraw-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(232, 62, 140, 0.3);
            font-weight: 500;
            margin-top: 1rem;
            display: inline-flex;
            align-items: center;
        }
        
        .withdraw-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(232, 62, 140, 0.4);
        }
        
        footer {
            margin-top: 3rem;
            text-align: center;
            font-size: 0.9rem;
            color: #888;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem;
                border-radius: 12px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .message {
                padding: 1rem;
                font-size: 1rem;
            }
            
            .wheel-wrapper {
                width: 280px;
                height: 280px;
            }
            
            .wheel-title {
                font-size: 1.3rem;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Happy Rakshabandhan</h1>
        <p class="subtitle">Celebrating the Eternal Bond Between Brothers and Sisters</p>
        
        <div class="name-input">
            <input type="text" id="sender-name" placeholder="Enter your name" maxlength="30">
        </div>
        
        <div class="progress-share-section">
            <button class="share-btn" id="share-btn">
                <i class="fab fa-whatsapp"></i> Share on WhatsApp
            </button>
            
            <div class="progress-container">
                <div class="progress-text">Shares completed: <span id="share-count">0</span>/25</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="celebration" id="celebration" style="display: none;">
                    <i class="fas fa-sparkles"></i> You earned a spin!
                </div>
            </div>
        </div>
        
        <div class="image-container">
            <img src="raksha.png" alt="Rakshabandhan Celebration">
        </div>
        
        <div class="message" id="message">
            On this auspicious occasion of Rakshabandhan, I wish you happiness, prosperity, and endless joy. 
            May this sacred thread strengthen our bond and bring blessings to our lives. 
            No matter where life takes us, this bond will always remain special.
        </div>
        
        <div class="wheel-container">
            <h3 class="wheel-title">Rakhi Gift Wheel</h3>
            <div class="wheel-wrapper">
                <div class="wheel" id="wheel">
                    <!-- Wheel sections will be added by JavaScript -->
                </div>
                <div class="wheel-center"></div>
                <div class="wheel-pointer"></div>
            </div>
            <div class="spin-count" id="spin-count">Spins available: 0</div>
            <button class="spin-btn" id="spin-btn" disabled>
                <i class="fas fa-redo"></i> Spin the Wheel
            </button>
            <div class="result" id="result"></div>
        </div>
    </div>
    
    <!-- Custom Alert Dialog -->
    <div class="custom-alert" id="custom-alert">
        <div class="alert-content">
            <div class="alert-title">Congratulations! 🎉</div>
            <div class="alert-message" id="alert-message">You won Rs.100!</div>
            <button class="withdraw-btn" id="withdraw-btn">
                <i class="fas fa-rupee-sign"></i> Withdraw Now
            </button>
        </div>
    </div>
    
    <footer>
        <p>© 2023 Rakshabandhan Wishes | Made with <i class="fas fa-heart" style="color: var(--primary-color);"></i></p>
    </footer>
    
    <script>
        // Global variable to store the current prize
        let currentPrize = "";
        
        // Initialize from local storage
        let shareCount = localStorage.getItem('rakhiShareCount') ? parseInt(localStorage.getItem('rakhiShareCount')) : 0;
        let spinsUsed = localStorage.getItem('rakhiSpinsUsed') ? parseInt(localStorage.getItem('rakhiSpinsUsed')) : 0;
        let sharedLinks = JSON.parse(localStorage.getItem('rakhiSharedLinks') || '{}');
        let visitedShares = JSON.parse(localStorage.getItem('rakhiVisitedShares') || '{}');
        
        // Constants for spin calculation
        const maxShares = 25;
        const sharesPerSpin = 5;
        
        // Calculate spins available
        let spinsAvailable = Math.floor(shareCount / sharesPerSpin) - spinsUsed;
        if (spinsAvailable < 0) spinsAvailable = 0;
        
        // Check URL parameters for sender name and shareId
        const urlParams = new URLSearchParams(window.location.search);
        const senderName = urlParams.get('from');
        const shareId = urlParams.get('shareId');
        
        // Update message if sender name exists
        if (senderName) {
            document.getElementById('message').innerHTML = `
                <strong>From ${senderName}:</strong><br><br>
                On this auspicious occasion of Rakshabandhan, I wish you happiness, prosperity, and endless joy. 
                May this sacred thread strengthen our bond and bring blessings to our lives. 
                No matter where life takes us, this bond will always remain special.
            `;
        }
        
        // Count unique shares when link is opened
        if (shareId && !visitedShares[shareId]) {
            visitedShares[shareId] = true;
            localStorage.setItem('rakhiVisitedShares', JSON.stringify(visitedShares));
            
            shareCount++;
            localStorage.setItem('rakhiShareCount', shareCount);
            updateProgress();
        }
        
        // Initialize UI
        updateProgress();
        
        // Wheel configuration
        const wheelPrizes = [
            { text: "100", value: "Rs.100", color: "#FF6384" },
            { text: "120", value: "Rs.120", color: "#36A2EB" },
            { text: "150", value: "Rs.150", color: "#FFCE56" },
            { text: "200", value: "Rs.200", color: "#4BC0C0" },
            { text: "250", value: "Rs.250", color: "#9966FF" },
            { text: "300", value: "Rs.300", color: "#FF9F40" }
        ];
        
        // Create wheel sections with centered text
        function createWheel() {
            const wheel = document.getElementById('wheel');
            wheel.innerHTML = '';
            
            const sectionAngle = 360 / wheelPrizes.length;
            
            wheelPrizes.forEach((prize, index) => {
                const section = document.createElement('div');
                section.className = 'wheel-section';
                section.style.backgroundColor = prize.color;
                section.style.transform = `rotate(${sectionAngle * index}deg)`;
                
                // Create text element positioned in the center of the triangle
                const text = document.createElement('div');
                text.textContent = prize.text;
                text.style.position = 'absolute';
                text.style.bottom = '50%';
                text.style.left = '50%';
                text.style.transform = 'translate(-50%, 50%) rotate(30deg)';
                text.style.width = '80px';
                text.style.textAlign = 'center';
                text.style.fontWeight = 'bold';
                text.style.fontSize = '14px';
                text.style.color = 'white';
                text.style.textShadow = '1px 1px 2px rgba(0,0,0,0.5)';
                
                section.appendChild(text);
                wheel.appendChild(section);
            });
        }
        
        // Initialize wheel
        createWheel();
        
        function updateProgress() {
            // Calculate percentage (max 100% at 25 shares)
            const percentage = Math.min(shareCount, maxShares) * (100/maxShares);
            document.getElementById('progress-fill').style.width = `${percentage}%`;
            document.getElementById('share-count').textContent = shareCount;
            
            // Recalculate spins available
            spinsAvailable = Math.floor(shareCount / sharesPerSpin) - spinsUsed;
            if (spinsAvailable < 0) spinsAvailable = 0;
            
            // Update UI
            document.getElementById('spin-count').textContent = `Spins available: ${spinsAvailable}`;
            
            if (spinsAvailable > 0) {
                document.getElementById('spin-btn').disabled = false;
                document.getElementById('celebration').style.display = 'block';
                document.getElementById('progress-fill').classList.add('bloom');
            } else {
                document.getElementById('spin-btn').disabled = true;
                document.getElementById('celebration').style.display = 'none';
                document.getElementById('progress-fill').classList.remove('bloom');
            }
        }
        
        // Share on WhatsApp function
        document.getElementById('share-btn').addEventListener('click', function() {
            const senderName = document.getElementById('sender-name').value.trim();
            
            if (!senderName) {
                alert('Please enter your name before sharing');
                return;
            }
            
            // Generate unique shareId
            const shareId = Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
            const baseUrl = window.location.href.split('?')[0];
            const shareUrl = new URL(baseUrl);
            shareUrl.searchParams.set('from', senderName);
            shareUrl.searchParams.set('shareId', shareId);
            
            const message = `🌸 Happy Rakshabandhan from ${senderName}! 🌼\n\nClick here: ${shareUrl.toString()}`;
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            
            // Try to open in app first, fallback to new tab
            try {
                window.location.href = whatsappUrl;
            } catch(e) {
                window.open(whatsappUrl, '_blank');
            }
            
            // Track this share if it's new
            if (!sharedLinks[shareId]) {
                sharedLinks[shareId] = true;
                localStorage.setItem('rakhiSharedLinks', JSON.stringify(sharedLinks));
                
                shareCount++;
                localStorage.setItem('rakhiShareCount', shareCount);
                updateProgress();
            }
        });
        
        // Spin the wheel function
        document.getElementById('spin-btn').addEventListener('click', function() {
            if (spinsAvailable <= 0) return;
            
            // Decrement spins and update storage
            spinsAvailable--;
            spinsUsed++;
            localStorage.setItem('rakhiSpinsUsed', spinsUsed);
            
            const wheel = document.getElementById('wheel');
            const spinBtn = document.getElementById('spin-btn');
            const result = document.getElementById('result');
            
            // Update UI immediately
            document.getElementById('spin-count').textContent = `Spins available: ${spinsAvailable}`;
            spinBtn.disabled = true;
            result.textContent = '';
            
            // Random rotation (5 full rotations + random prize angle)
            const sectionAngle = 360 / wheelPrizes.length;
            const prizeIndex = Math.floor(Math.random() * wheelPrizes.length);
            currentPrize = wheelPrizes[prizeIndex].value;
            
            // Calculate rotation so the selected segment lands at bottom (180 degrees)
            const segmentCenterAngle = sectionAngle * prizeIndex + sectionAngle/2;
            const rotation = 1800 + (180 - segmentCenterAngle);
            
            wheel.style.transform = `rotate(${rotation}deg)`;
            
            // Show result after spin completes
            setTimeout(() => {
                result.textContent = `Congratulations! You won ${currentPrize}!`;
                spinBtn.disabled = spinsAvailable <= 0;
                
                // Show custom alert with prize amount
                showWinAlert(currentPrize);
                
                // Confetti effect
                if (typeof confetti === 'function') {
                    confetti({
                        particleCount: 150,
                        spread: 70,
                        origin: { y: 0.6 },
                        colors: ['#e83e8c', '#6f42c1', '#ffc107']
                    });
                }
            }, 4000);
        });

        // Show custom alert with prize amount
        function showWinAlert(prize) {
            const alert = document.getElementById('custom-alert');
            const message = document.getElementById('alert-message');
            
            message.textContent = `You won ${prize}!`;
            alert.style.display = 'flex';
        }

        // Close alert and open withdrawal page with prize amount
        document.getElementById('withdraw-btn').addEventListener('click', function() {
            const alert = document.getElementById('custom-alert');
            alert.style.display = 'none';
            
            // Open withdrawal.html with prize amount as URL parameter
            const withdrawUrl = new URL('withdrawal.html', window.location.href);
            withdrawUrl.searchParams.set('prize', currentPrize);
            window.open(withdrawUrl.toString(), '_blank');
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
</body>
</html>
